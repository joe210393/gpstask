# Zeabur 部署配置
# 定義兩個服務：主應用 (Node.js) + Embedding API (Python)

services:
  # 主 Node.js Express 應用
  gps-task:
    type: docker
    source:
      git:
        repo: joe210393/gpstask
        branch: main
    ports:
      - port: 3001
        protocol: http
    env:
      NODE_ENV: production
      PORT: "3001"
      # Zeabur 內網呼叫另一個 service，hostname 會是 zeabur.yaml 裡的 service key
      # 這個 repo 內的 embedding 服務 key 是 embedding-api
      EMBEDDING_API_URL: http://embedding-api:8080

  # Python 植物向量搜尋 API
  embedding-api:
    type: docker
    source:
      git:
        repo: joe210393/gpstask
        branch: main
        dockerfile: Dockerfile.embedding
    ports:
      - port: 8080
        protocol: http
    env:
      QDRANT_URL: https://gps-task-qdrant.zeabur.app
      QDRANT_API_KEY: ${QDRANT_API_KEY}
      PORT: "8080"
