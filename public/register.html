<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>註冊 | GPS 觸發任務系統</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="icon" type="image/png" href="/images/mascot.png" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header id="mainHeader">
    <div class="header-content" id="headerContent">
      <h1 id="pageTitle">註冊</h1>
      <button id="hamburgerBtn" class="hamburger" aria-label="展開選單">&#9776;</button>
      <nav class="main-nav">
        <a href="/index.html">首頁</a>
        <a href="/map.html">地圖頁</a>
        <a href="/tasks-list.html" id="navTasksList">任務列表</a>
        <a href="/user-tasks.html">任務審核</a>
        <a href="/staff-dashboard.html" id="navStaff" style="display:none;">新增任務</a>
        <a href="/user-dashboard.html" id="navUserTasks" style="display:none;">用戶任務管理</a>
        <a href="/products.html" id="navProducts">商品兌換</a>
        <a href="/redeem-tasks.html" id="navRedeem" style="display:none;">兌換商品管理</a>
        <span id="loginUserInfo" style="display:none; color:var(--text-secondary); padding:0.5rem 1rem;"></span>
        <button id="logoutBtn" style="display:none;">登出</button>
      </nav>
    </div>
  </header>

  <main>
    <div class="form-container">
      <h2 class="text-center mb-4" style="color:var(--text-primary);">註冊新帳號</h2>
      
      <form id="registerForm">
        <div class="form-group">
          <label class="form-label">手機門號</label>
          <input class="form-input" type="text" name="username" required pattern="[0-9]{10}" maxlength="10" placeholder="請輸入10碼手機號碼" />
          <small style="color: var(--text-secondary); display: block; margin-top: 5px;">我們將以此作為您的登入帳號</small>
        </div>
        <button type="submit" class="btn btn-success w-100">註冊</button>
        <div id="registerMsg" class="mt-2 text-center" style="min-height: 24px;"></div>
      </form>

      <div class="text-center mt-4" style="border-top: 1px solid #eee; padding-top: 1rem;">
        <span style="color: var(--text-secondary);">已經有帳號？</span>
        <a href="/login.html" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">立即登入</a>
      </div>
    </div>
  </main>

  <footer>
    &copy; 2025 GPS 任務系統 - 地方開箱任務遊戲
  </footer>
  <script src="/js/register.js"></script>
  <script>
    // Header功能
    const loginUser = JSON.parse(localStorage.getItem('loginUser') || 'null');

    if (loginUser) {
        const userInfoSpan = document.getElementById('loginUserInfo');
        userInfoSpan.style.display = 'inline-block';
        userInfoSpan.textContent = getUserDisplayName(loginUser);
        
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn.style.display = 'inline-block';
        logoutBtn.onclick = function() {
            localStorage.removeItem('loginUser');
            window.location.href = '/login.html';
        };

        // 根據權限顯示導航鏈接
        if (loginUser.role === 'admin') {
            document.getElementById('navStaff').style.display = '';
            document.getElementById('navRedeem').style.display = '';
        } else if (loginUser.role === 'shop') {
            document.getElementById('navStaff').style.display = '';
            document.getElementById('navRedeem').style.display = '';
        }
        if (loginUser.role === 'user') {
            document.getElementById('navUserTasks').style.display = '';
        }
        
        // 隱藏任務列表對工作人員
        if (loginUser.role === 'shop' || loginUser.role === 'admin') {
            const navTasksList = document.getElementById('navTasksList');
            if (navTasksList) navTasksList.style.display = 'none';
        }
    }

    function getUserDisplayName(loginUser) {
        switch(loginUser.role) {
            case 'admin': return `管理員：${loginUser.username}`;
            case 'shop': return `商店：${loginUser.username}`;
            case 'user': return `用戶：${loginUser.username}`;
            default: return loginUser.username;
        }
    }

    document.getElementById('hamburgerBtn').onclick = function() {
        document.getElementById('headerContent').classList.toggle('open');
    };
    
    document.querySelectorAll('.main-nav a').forEach(a => {
        a.onclick = () => document.getElementById('headerContent').classList.remove('open');
    });
  </script>
  <script src="/js/nav-access.js"></script>
</body>
</html>
