<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GPS AR Giant Debug</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>
    <!-- åŠ å…¥ A-Frame Extras è®“æ¨¡å‹å‹•ç•«å¯ä»¥æ’­æ”¾ -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        .debug-ui {
            position: fixed; top: 10px; left: 10px; z-index: 99999;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            pointer-events: none;
            max-width: 80%;
            border-radius: 8px;
        }
        .action-btn {
            position: fixed; bottom: 30px; left: 50%;
            transform: translateX(-50%);
            z-index: 99999;
            padding: 15px 30px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            pointer-events: auto;
            white-space: nowrap;
        }
    </style>
</head>
<body style='margin: 0; overflow: hidden;'>

    <div class="debug-ui" id="debug-text">
        åˆå§‹åŒ– GPS...<br>
        è«‹èµ°åˆ°æˆ¶å¤–æˆ–æ˜¯çª—é‚Šæ¸¬è©¦
    </div>

    <button id="spawn-btn" class="action-btn">ğŸŸï¸ åœ¨é€™è£¡å»ºç«‹å·¨äººåœ°æ¨™</button>

    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; debugUIEnabled: false;'
        renderer="logarithmicDepthBuffer: true; colorManagement: true;">

        <!-- å¢åŠ  maxDistance åˆ° 2000ï¼Œç¢ºä¿çœ‹å¾—åˆ°é è™•ç‰©é«” -->
        <a-camera gps-camera="minDistance: 0; maxDistance: 2000;" rotation-reader></a-camera>

        <!-- 3D æ¨¡å‹è³‡æº -->
        <a-assets>
            <a-asset-item id="animated-model" src="/models/result.glb"></a-asset-item>
        </a-assets>

        <!-- å››æ–¹å·¨æŸ± (åˆå§‹éš±è—) -->
        <a-cylinder id="col-n" color="red" height="30" radius="2" visible="false"></a-cylinder>
        <a-cylinder id="col-e" color="green" height="30" radius="2" visible="false"></a-cylinder>
        <a-cylinder id="col-s" color="blue" height="30" radius="2" visible="false"></a-cylinder>
        <a-cylinder id="col-w" color="yellow" height="30" radius="2" visible="false"></a-cylinder>
        
        <!-- ä¸­å¿ƒé»æ¨™è¨˜ -->
        <a-box id="col-center" color="white" scale="1 1 1" visible="false"></a-box>

        <!-- ä½¿ç”¨è€…çš„ 3D æ¨¡å‹ (æ”¾åœ¨åŒ—æ–¹ç´…æŸ±æ—) -->
        <a-entity 
            id="ar-model"
            gltf-model="#animated-model"
            animation-mixer
            scale="5 5 5" 
            visible="false"> 
        </a-entity>

    </a-scene>

    <script>
        const debugText = document.getElementById('debug-text');
        const spawnBtn = document.getElementById('spawn-btn');
        let currentPos = null;

        // ç›£è½ GPS æ›´æ–° (é¡¯ç¤ºç²¾åº¦)
        window.addEventListener('gps-camera-update-position', (e) => {
            currentPos = e.detail.position;
            
            // accuracy ä»£è¡¨èª¤å·®ç¯„åœ (å…¬å°º)
            // å¦‚æœ accuracy > 50ï¼Œä»£è¡¨ä½ åœ¨å®¤å…§ï¼ŒåŸºæœ¬ä¸Š AR ä¸æœƒæº–
            const acc = e.detail.position.accuracy || 0;
            
            debugText.innerHTML = `
                GPS å·²é–å®š ğŸ›°ï¸<br>
                Lat: ${currentPos.latitude.toFixed(6)}<br>
                Lng: ${currentPos.longitude.toFixed(6)}<br>
                èª¤å·®: Â±${acc.toFixed(1)} å…¬å°º<br>
                (èª¤å·®è‹¥å¤§æ–¼ 20m è«‹ç§»å‹•åˆ°æˆ¶å¤–)
            `;
            
            spawnBtn.style.background = "#28a745"; // è®Šç¶ è‰²ä»£è¡¨ Ready
        });

        spawnBtn.addEventListener('click', () => {
            if(!currentPos) {
                alert("å°šæœªæŠ“åˆ° GPS è¨Šè™Ÿï¼è«‹ç¨å€™...");
                return;
            }

            const lat = currentPos.latitude;
            const lng = currentPos.longitude;

            // è¨­å®šè·é›¢ï¼š20 å…¬å°º (æ¯”è¼ƒä¿éšªçš„è·é›¢ï¼Œé¿é–‹è¿‘è·é›¢è£åˆ‡)
            // ç¶“ç·¯åº¦æ›ç®—ï¼šç´„ 0.00018 åº¦
            const offset = 0.00018; 

            // 1. æ”¾ç½®åŒ—æŸ± (ç´…)
            placeObject('col-n', lat + offset, lng, 'åŒ—æ–¹ 20m (ç´…)');
            
            // é †ä¾¿æ”¾ç½®ä½¿ç”¨è€…çš„ 3D æ¨¡å‹åœ¨åŒ—æŸ±æ— (ç¨å¾®åä¸€é»é»)
            const modelEl = document.getElementById('ar-model');
            modelEl.setAttribute('gps-entity-place', `latitude: ${lat + offset}; longitude: ${lng};`);
            modelEl.setAttribute('position', '5 0 0'); // åœ¨ç´…æŸ±å³é‚Š 5 ç±³
            modelEl.setAttribute('visible', 'true');

            // 2. æ”¾ç½®å—æŸ± (è—)
            placeObject('col-s', lat - offset, lng, 'å—æ–¹ 20m (è—)');
            
            // 3. æ”¾ç½®æ±æŸ± (ç¶ )
            placeObject('col-e', lat, lng + offset, 'æ±æ–¹ 20m (ç¶ )');
            
            // 4. æ”¾ç½®è¥¿æŸ± (é»ƒ)
            placeObject('col-w', lat, lng - offset, 'è¥¿æ–¹ 20m (é»ƒ)');

            // 5. æ”¾ç½®ä¸­å¿ƒé»
            placeObject('col-center', lat, lng, 'è…³ä¸‹');

            spawnBtn.style.display = 'none'; // éš±è—æŒ‰éˆ•
            debugText.innerHTML += "<br>âœ… å·¨æŸ±å·²ç”Ÿæˆï¼è«‹åŸåœ°è½‰åœˆå°‹æ‰¾";
        });

        function placeObject(id, lat, lng, label) {
            const el = document.getElementById(id);
            el.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
            
            // y=15 ä»£è¡¨æŸ±å­ä¸­å¿ƒåœ¨é›¢åœ° 15ç±³è™• (å› ç‚ºæŸ±é«˜30ç±³ï¼Œé€™æ¨£å‰›å¥½ç«‹åœ¨åœ°ä¸Š)
            // ä¸­å¿ƒé»ç›’å­å‰‡è²¼åœ°
            if (id === 'col-center') {
                el.setAttribute('position', '0 0 0');
            } else {
                el.setAttribute('position', '0 15 0'); 
            }
            
            el.setAttribute('visible', 'true');
            console.log(`Placed ${label} at ${lat}, ${lng}`);
        }
    </script>
</body>
</html>