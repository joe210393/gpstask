<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GPS AR 3D Test</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>
    <!-- A-Frame Extras (for animation-mixer) -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <!-- Look-at component (optional, makes model face user) -->
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        .debug-ui {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .debug-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: #0f0;
            padding: 5px;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>

<body style='margin: 0; overflow: hidden;'>
    
    <div id="info">GPS AR 3D Ê∏¨Ë©¶Ê®°Âºè</div>

    <div class="debug-ui">
        <div class="debug-row">
            <span>Scale (Â§ßÂ∞è): <span id="scale-val">0.5</span></span>
            <input type="range" id="scale-slider" min="0.1" max="50" step="0.1" value="0.5">
        </div>
        <div class="debug-row">
            <span>Height (È´òÂ∫¶): <span id="height-val">0</span></span>
            <input type="range" id="height-slider" min="-10" max="10" step="0.5" value="0">
        </div>
        <div class="debug-row">
            <button id="set-loc-btn">üìç ÊîæÁΩÆÊ®°ÂûãÂú®Áï∂Ââç‰ΩçÁΩÆ</button>
            <span id="dist-val">Ë∑ùÈõ¢: ? m</span>
        </div>
        <div class="debug-row">
            <span>Ê®°Êì¨ GPS: </span>
            <button onclick="simulateMove(0.0001, 0)">ÂåóÁßª</button>
            <button onclick="simulateMove(-0.0001, 0)">ÂçóÁßª</button>
        </div>
    </div>

    <!-- 
        vr-mode-ui="enabled: false": ÈóúÈñâÂè≥‰∏ãËßíÁöÑ VR ÁúºÈè°ÊåâÈàï
        arjs: Ë®≠ÂÆö AR.js ÂèÉÊï∏ÔºåsourceType: webcam ÈñãÂïüÁõ∏Ê©ü
    -->
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false;'
        renderer="logarithmicDepthBuffer: true;">

        <!-- È†êËºâË≥áÊ∫êÔºö‰ΩøÁî®‰∏ÄÂÄãÂÖ¨ÈñãÁöÑ CesiumMan Ê®°Âûã (ÊúÉËµ∞Ë∑ØÁöÑÂ∞è‰∫∫) -->
        <a-assets>
            <a-asset-item id="animated-model" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/CesiumMan/glTF-Binary/CesiumMan.glb"></a-asset-item>
        </a-assets>

        <!-- 
            gps-camera: ËôïÁêÜ GPS ÂÆö‰Ωç
            rotation-reader: ËôïÁêÜÁæÖÁõ§ÊñπÂêë
            minDistance: ÊúÄÂ∞èÈ°ØÁ§∫Ë∑ùÈõ¢
            maxDistance: ÊúÄÂ§ßÈ°ØÁ§∫Ë∑ùÈõ¢
        -->
        <a-camera gps-camera rotation-reader></a-camera>

        <!-- 
            3D ÂØ¶È´î 
            gps-entity-place: Ë®≠ÂÆöÁ∂ìÁ∑ØÂ∫¶ (ÊúÉÂú® JS ‰∏≠ÂãïÊÖãË®≠ÂÆö)
            gltf-model: ÊåáÂÆöÊ®°Âûã
            animation-mixer: Êí≠ÊîæÂãïÁï´
            look-at: ËÆìÊ®°ÂûãÊ∞∏ÈÅ†Èù¢ÂêëÈè°È†≠
        -->
        <a-entity 
            id="ar-model"
            gltf-model="#animated-model"
            animation-mixer
            scale="0.5 0.5 0.5"
            look-at="[gps-camera]"
            position="0 0 0">
        </a-entity>

    </a-scene>

    <script>
        const model = document.getElementById('ar-model');
        const setLocBtn = document.getElementById('set-loc-btn');
        const distDisplay = document.getElementById('dist-val');
        
        // UI Controls
        const scaleSlider = document.getElementById('scale-slider');
        const heightSlider = document.getElementById('height-slider');
        const scaleVal = document.getElementById('scale-val');
        const heightVal = document.getElementById('height-val');

        // Ë™øÊï¥Â§ßÂ∞è
        scaleSlider.addEventListener('input', (e) => {
            const val = e.target.value;
            model.setAttribute('scale', `${val} ${val} ${val}`);
            scaleVal.textContent = val;
        });

        // Ë™øÊï¥È´òÂ∫¶ (YËª∏)
        heightSlider.addEventListener('input', (e) => {
            const val = e.target.value;
            // ‰øùÊåÅÂéüÊú¨ÁöÑ gps-entity-placeÔºåÂè™Êîπ position ÁöÑ y
            // Ê≥®ÊÑèÔºögps-entity-place ÊúÉË¶ÜËìã position ÁöÑ x, zÔºåÊâÄ‰ª•ÈÄöÂ∏∏Áõ¥Êé•‰øÆÊîπ position Â±¨ÊÄßÂèØËÉΩÊúÉË¢´ËìãÊéâ
            // ÈÄôË£°ÊàëÂÄëÂòóË©¶Áî® translateY
            model.object3D.position.y = parseFloat(val);
            heightVal.textContent = val;
        });

        // Êåâ‰∏ãÊåâÈàïÊôÇÔºåÂ∞áÊ®°ÂûãÊîæÁΩÆÂú®‰ΩøÁî®ËÄÖÁï∂Ââç‰ΩçÁΩÆÁöÑ"Á®çÂæÆÂâçÈù¢‰∏ÄÈªû"
        setLocBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // ÁÇ∫‰∫ÜÊ∏¨Ë©¶ÔºåÊàëÂÄë‰∏çÂÆåÂÖ®ÊîæÂú®ÂéüÈªûÔºåÁ®çÂæÆÂÅèÁßª‰∏ÄÈªûÈªû (‰æãÂ¶ÇÂåóÊñπ 0.0001 Â∫¶ÔºåÁ¥Ñ 10 ÂÖ¨Â∞∫)
                    // ÈÄôÊ®£ÊâçÁúãÂæóÂà∞Ôºå‰∏çÊúÉÂú®ËÖ≥Â∫ï‰∏ã
                    // 0.0001 Â∫¶Á¥ÑÁ≠âÊñº 11 ÂÖ¨Â∞∫
                    const newLat = lat + 0.0001; 
                    const newLng = lng;

                    console.log(`Setting model to: ${newLat}, ${newLng}`);
                    
                    // Ë®≠ÂÆöÊ®°ÂûãÁöÑ GPS Â∫ßÊ®ô
                    model.setAttribute('gps-entity-place', `latitude: ${newLat}; longitude: ${newLng};`);
                    
                    alert(`Ê®°ÂûãÂ∑≤ÊîæÁΩÆÂú®ÊÇ®ÂåóÊñπÁ¥Ñ 10 ÂÖ¨Â∞∫ËôïÔºÅ\nLat: ${newLat.toFixed(6)}\nLng: ${newLng.toFixed(6)}`);

                }, (err) => {
                    alert('ÁÑ°Ê≥ïÁç≤Âèñ GPS: ' + err.message);
                }, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            } else {
                alert('ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ Geolocation');
            }
        });

        // Áõ£ËÅΩË∑ùÈõ¢‰∫ã‰ª∂ (AR.js ÁâπÊúâ‰∫ã‰ª∂)
        model.addEventListener('gps-entity-place-update-positon', (event) => {
            if(event.detail.distance) {
                distDisplay.textContent = `Ë∑ùÈõ¢: ${event.detail.distance.toFixed(1)} m`;
            }
        });
        
        // Ê®°Êì¨ÁßªÂãï (Ê∏¨Ë©¶Áî®)
        window.simulateMove = function(dLat, dLng) {
            // ÈÄôÈÇäÂè™ËÉΩÊ®°Êì¨ model ÁöÑ‰ΩçÁΩÆÊîπËÆäÔºåÊØîËºÉÈõ£Ê®°Êì¨ camera ÁöÑ GPS
            // Á∞°ÂñÆËµ∑Ë¶ãÔºåÊàëÂÄëÁõ¥Êé•ÁßªÂãïÊ®°Âûã
            const currentAttr = model.getAttribute('gps-entity-place');
            if (currentAttr) {
                // Ëß£ÊûêÁèæÊúâÂ∫ßÊ®ô (ÈÄôÊØîËºÉÈ∫ªÁÖ©ÔºåÂÖà‰∏çÂØ¶‰ΩúË§áÈõúËß£Êûê)
                // ÈÄôË£°ÁïôÁµ¶ÈñãÁôºËÄÖÊ∏¨Ë©¶Áî®
                console.log('Simulate move not fully implemented via JS buttons yet, rely on real GPS');
            }
        };
        
        // ‰∏ÄÈñãÂßãÂÖàÂòóË©¶Ëá™ÂãïÊîæÁΩÆ‰∏ÄÊ¨°
        setTimeout(() => {
            setLocBtn.click();
        }, 3000);

    </script>
</body>
</html>
