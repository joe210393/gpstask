<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GPS AR Giant Debug</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>
    <!-- åŠ å…¥ A-Frame Extras è®“æ¨¡å‹å‹•ç•«å¯ä»¥æ’­æ”¾ -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        .debug-ui {
            position: fixed; top: 10px; left: 10px; z-index: 99999;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            pointer-events: none;
            max-width: 80%;
            border-radius: 8px;
        }
        .action-btn {
            position: fixed; bottom: 30px; left: 50%;
            transform: translateX(-50%);
            z-index: 99999;
            padding: 15px 30px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            pointer-events: auto;
            white-space: nowrap;
        }
    </style>
</head>
<body style='margin: 0; overflow: hidden;'>

    <div class="debug-ui" id="debug-text">
        åˆå§‹åŒ– GPS...<br>
        è«‹èµ°åˆ°æˆ¶å¤–æˆ–æ˜¯çª—é‚Šæ¸¬è©¦
    </div>

    <button id="spawn-btn" class="action-btn">ğŸŸï¸ åœ¨é€™è£¡å»ºç«‹å·¨äººåœ°æ¨™</button>

    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; debugUIEnabled: false;'
        renderer="logarithmicDepthBuffer: true; colorManagement: true;">

        <!-- å¢åŠ  maxDistance åˆ° 2000ï¼Œç¢ºä¿çœ‹å¾—åˆ°é è™•ç‰©é«” -->
        <a-camera gps-camera="minDistance: 0; maxDistance: 2000;" rotation-reader></a-camera>

        <!-- 3D æ¨¡å‹è³‡æº -->
        <a-assets>
            <a-asset-item id="animated-model" src="/models/result.glb"></a-asset-item>
        </a-assets>

        <!-- å››æ–¹å·¨æŸ± (åˆå§‹éš±è—) -->
        <!-- æ”¹ç”¨è¶…å·¨å¤§å°ºå¯¸ï¼šé«˜åº¦ 100ï¼ŒåŠå¾‘ 5 -->
        <a-cylinder id="col-n" color="red" height="100" radius="5" visible="false" look-at="[gps-camera]"></a-cylinder>
        <a-cylinder id="col-e" color="green" height="100" radius="5" visible="false" look-at="[gps-camera]"></a-cylinder>
        <a-cylinder id="col-s" color="blue" height="100" radius="5" visible="false" look-at="[gps-camera]"></a-cylinder>
        <a-cylinder id="col-w" color="yellow" height="100" radius="5" visible="false" look-at="[gps-camera]"></a-cylinder>
        
        <!-- ä¸­å¿ƒé»æ¨™è¨˜ -->
        <a-box id="col-center" color="white" scale="2 2 2" visible="false"></a-box>

        <!-- ä½¿ç”¨è€…çš„ 3D æ¨¡å‹ -->
        <a-entity 
            id="ar-model"
            gltf-model="#animated-model"
            animation-mixer
            scale="50 50 50" 
            visible="false"
            look-at="[gps-camera]"> 
        </a-entity>

    </a-scene>

    <script>
        const debugText = document.getElementById('debug-text');
        const spawnBtn = document.getElementById('spawn-btn');
        let currentPos = null;

        // ç›£è½ GPS æ›´æ–°
        window.addEventListener('gps-camera-update-position', (e) => {
            currentPos = e.detail.position;
            const acc = e.detail.position.accuracy || 0;
            
            debugText.innerHTML = `
                GPS å·²é–å®š ğŸ›°ï¸<br>
                Lat: ${currentPos.latitude.toFixed(6)}<br>
                Lng: ${currentPos.longitude.toFixed(6)}<br>
                èª¤å·®: Â±${acc.toFixed(1)} å…¬å°º<br>
                Alt: ${e.detail.position.altitude || 0}m
            `;
            
            spawnBtn.style.background = "#28a745"; 
        });

        spawnBtn.addEventListener('click', () => {
            if(!currentPos) {
                alert("å°šæœªæŠ“åˆ° GPS è¨Šè™Ÿï¼è«‹ç¨å€™...");
                return;
            }

            const lat = currentPos.latitude;
            const lng = currentPos.longitude;

            // è·é›¢æ‹‰è¿‘ä¸€é»é»ï¼š10 å…¬å°º (ç´„ 0.00009 åº¦)
            // å› ç‚ºå¤ªé å¯èƒ½è¢«åˆ‡æ‰ï¼Œå¤ªè¿‘å¯èƒ½é£„èµ°ï¼ŒæŠ˜è¡·ä¸€ä¸‹
            const offset = 0.00009; 

            // åŒ—æŸ± (ç´…)
            placeObject('col-n', lat + offset, lng, 'åŒ—æ–¹ (ç´…)');
            
            // æ¨¡å‹æ”¾åœ¨åŒ—æŸ±æ—é‚Š
            const modelEl = document.getElementById('ar-model');
            modelEl.setAttribute('gps-entity-place', `latitude: ${lat + offset}; longitude: ${lng};`);
            // Y=20 è®“å®ƒæµ®åœ¨ç©ºä¸­ï¼Œé¿å…è¢«åŸ‹åœ¨åœ°ä¸‹
            modelEl.setAttribute('position', '5 20 0'); 
            modelEl.setAttribute('visible', 'true');

            // å—æŸ± (è—)
            placeObject('col-s', lat - offset, lng, 'å—æ–¹ (è—)');
            
            // æ±æŸ± (ç¶ )
            placeObject('col-e', lat, lng + offset, 'æ±æ–¹ (ç¶ )');
            
            // è¥¿æŸ± (é»ƒ)
            placeObject('col-w', lat, lng - offset, 'è¥¿æ–¹ (é»ƒ)');

            // ä¸­å¿ƒé»
            const centerEl = document.getElementById('col-center');
            centerEl.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
            centerEl.setAttribute('position', '0 0 0');
            centerEl.setAttribute('visible', 'true');

            spawnBtn.style.display = 'none';
            debugText.innerHTML += "<br>âœ… å·²ç”Ÿæˆ (é«˜åº¦æŠ¬å‡ + å°ºå¯¸æ”¾å¤§)";
        });

        function placeObject(id, lat, lng, label) {
            const el = document.getElementById(id);
            el.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
            
            // å¼·åˆ¶æŠ¬å‡ 50 å…¬å°ºï¼
            // å¦‚æœä¹‹å‰åœ¨è…³ä¸‹ï¼Œé€™æ¬¡æ‡‰è©²æœƒæµ®ç¾åœ¨çœ¼å‰æˆ–é ­é ‚
            el.setAttribute('position', '0 50 0'); 
            
            el.setAttribute('visible', 'true');
            console.log(`Placed ${label} at ${lat}, ${lng}`);
        }
    </script>
</body>
</html>