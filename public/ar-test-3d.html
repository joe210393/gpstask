<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GPS AR Giant Debug</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js'></script>
    <!-- åŠ å…¥ A-Frame Extras è®“æ¨¡å‹å‹•ç•«å¯ä»¥æ’­æ”¾ -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <!-- åŠ å…¥ look-at å¥—ä»¶ï¼Œè®“æ–‡å­—æ°¸é é¢å‘ä½¿ç”¨è€… -->
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        .debug-ui {
            position: fixed; top: 10px; left: 10px; z-index: 99999;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            pointer-events: none;
            max-width: 80%;
            border-radius: 8px;
        }
        .action-btn {
            position: fixed; bottom: 30px; left: 50%;
            transform: translateX(-50%);
            z-index: 99999;
            padding: 15px 30px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            pointer-events: auto;
            white-space: nowrap;
        }
    </style>
</head>
<body style='margin: 0; overflow: hidden;'>

    <div class="debug-ui" id="debug-text">
        åˆå§‹åŒ– GPS...<br>
        è«‹èµ°åˆ°æˆ¶å¤–æˆ–æ˜¯çª—é‚Šæ¸¬è©¦
    </div>

    <button id="spawn-btn" class="action-btn">ğŸŸï¸ åœ¨é€™è£¡å»ºç«‹å·¨äººåœ°æ¨™</button>

    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; debugUIEnabled: false;'
        renderer="logarithmicDepthBuffer: true; colorManagement: true;">

        <!-- å¢åŠ  maxDistance åˆ° 2000ï¼Œç¢ºä¿çœ‹å¾—åˆ°é è™•ç‰©é«” -->
        <a-camera gps-camera="minDistance: 0; maxDistance: 2000;" rotation-reader></a-camera>

        <!-- 3D æ¨¡å‹è³‡æº -->
        <a-assets>
            <a-asset-item id="animated-model" src="/models/result.glb"></a-asset-item>
        </a-assets>

        <!-- å››æ–¹å·¨æŸ± (ç§»é™¤) -->
        
        <!-- ä¸­å¿ƒé»æ¨™è¨˜ (ä¿ç•™ï¼Œæ–¹ä¾¿ç¢ºèªè…³ä¸‹) -->
        <a-box id="col-center" color="white" scale="1 1 1" visible="false"></a-box>

        <!-- ä½¿ç”¨è€…çš„ 3D æ¨¡å‹ -->
        <a-entity 
            id="ar-model"
            gltf-model="#animated-model"
            animation-mixer
            scale="10 10 10" 
            visible="false"
            look-at="[gps-camera]"> 
        </a-entity>

    </a-scene>

    <script>
        const debugText = document.getElementById('debug-text');
        const spawnBtn = document.getElementById('spawn-btn');
        let currentPos = null;

        // ç›£è½ GPS æ›´æ–° (é¡¯ç¤ºç²¾åº¦)
        window.addEventListener('gps-camera-update-position', (e) => {
            currentPos = e.detail.position;
            const acc = e.detail.position.accuracy || 0;
            
            debugText.innerHTML = `
                GPS å·²é–å®š ğŸ›°ï¸<br>
                Lat: ${currentPos.latitude.toFixed(6)}<br>
                Lng: ${currentPos.longitude.toFixed(6)}<br>
                èª¤å·®: Â±${acc.toFixed(1)} å…¬å°º<br>
                Alt: ${e.detail.position.altitude || 0}m
            `;
            
            spawnBtn.style.background = "#28a745"; 
        });

        spawnBtn.addEventListener('click', () => {
            if(!currentPos) {
                alert("å°šæœªæŠ“åˆ° GPS è¨Šè™Ÿï¼è«‹ç¨å€™...");
                return;
            }

            const lat = currentPos.latitude;
            const lng = currentPos.longitude;

            // è¨­å®šè·é›¢ï¼š100 å…¬å°º (å†æ‹‰é ä¸€é»)
            // ç¶“ç·¯åº¦æ›ç®—ï¼šç´„ 0.0009 åº¦
            const offset = 0.0009; 

            // æ¨¡å‹æ”¾åœ¨åŒ—æ–¹ 100m
            const modelEl = document.getElementById('ar-model');
            modelEl.setAttribute('gps-entity-place', `latitude: ${lat + offset}; longitude: ${lng};`);
            
            // Y=5 ç¨å¾®æŠ¬é«˜
            // Scale=0.5 (å› ç‚ºæ¨¡å‹åŸå§‹å°ºå¯¸ä¼¼ä¹éå¸¸å·¨å¤§ï¼Œæ‰€ä»¥æˆ‘å€‘ç¸®å°å®ƒ)
            modelEl.setAttribute('position', '0 5 0'); 
            modelEl.setAttribute('scale', '0.5 0.5 0.5');
            modelEl.setAttribute('visible', 'true');

            // ä¸­å¿ƒé»
            const centerEl = document.getElementById('col-center');
            centerEl.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
            centerEl.setAttribute('position', '0 0 0');
            centerEl.setAttribute('visible', 'true');

            spawnBtn.style.display = 'none';
            debugText.innerHTML += "<br>âœ… æ¨¡å‹å·²æ”¾ç½®åœ¨åŒ—æ–¹ 100m (ç¸®å°ç‚º 0.5x)";
        });

        function placeObject(id, lat, lng, label) {
            // ç§»é™¤æŸ±å­ç›¸é—œé‚è¼¯
        }
    </script>
</body>
</html>