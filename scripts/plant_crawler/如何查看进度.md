# 🌿 如何查看爬虫进度

## 📊 实时进度监控（推荐）

### 启动监控面板

在终端中运行：

```bash
cd /home/user/gpstask/scripts/plant_crawler
python3 monitor_live.py
```

**效果：**
- ✅ 自动刷新的进度界面
- 📊 可视化进度条
- ⏱️  实时时间估算
- 📝 最新日志显示
- 🎯 预计完成时间

**特点：**
- 每5秒自动刷新
- 显示4个阶段的进度
- 已发现编码数量
- 剩余时间估算
- 按 `Ctrl+C` 退出（不会影响后台爬虫）

---

## 📝 查看日志文件

```bash
# 查看完整日志
cat smart_discovery.log

# 实时跟踪日志（动态显示新内容）
tail -f smart_discovery.log

# 查看最后50行
tail -50 smart_discovery.log
```

---

## 📊 快速查看进度

```bash
# 查看已发现的编码数量
wc -l all_plant_codes_progress.txt

# 查看日志最后几行
tail -10 smart_discovery.log

# 检查进程是否在运行
ps aux | grep smart_discovery
```

---

## 🎯 完整使用流程

### 第1步：启动爬虫（只需运行一次）

```bash
cd /home/user/gpstask/scripts/plant_crawler
python3 -u smart_discovery.py 0.5 > smart_discovery.log 2>&1 &
```

输出：`[1] 12345` （进程号）

### 第2步：打开进度监控

```bash
python3 monitor_live.py
```

您会看到类似这样的界面：

```
================================================================================
              🌿 台湾植物编码发现 - 实时进度监控
================================================================================

⏰ 当前时间: 2026-01-20 11:45:30

✅ 状态: 正在运行

--------------------------------------------------------------------------------

📊 总体进度:
  150/37,271 |████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░| 0.4% (0.40%)

📍 阶段进度:
  🔄 阶段1: 基础扫描: |████████░░░░░░░░░░░░░░░░░░░░░░░░░░| 150/901
  ⏳ 阶段2: 扩展属编号: |░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░| 待开始
  ⏳ 阶段3: 扩展种编号: |░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░| 待开始
  ⏳ 阶段4: 扩展变种编号: |░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░| 待开始

--------------------------------------------------------------------------------

✅ 已发现编码: 15 个

⏱️  已运行时间: 3分15秒
⏳ 预计剩余: 5小时12分
🎯 预计完成: 16:57:45 (01月20日)

--------------------------------------------------------------------------------

📝 最新日志:
  [11:45:28] 150/901 (16.6%) | 阶段发现: 15 | 剩余: 6分
  ✅ [11:45:25] 找到: 145+001+01+0 (总计: 15)
  [11:45:22] 145/901 (16.1%) | 阶段发现: 14 | 剩余: 6分

================================================================================
💡 按 Ctrl+C 退出监控 | 自动刷新中...
```

### 第3步：关闭监控（不影响爬虫）

按 `Ctrl+C` 退出监控，**爬虫继续在后台运行**

---

## 🔄 常用命令

### 查看进度（一次性，不监控）

```bash
# 简单版
tail -20 smart_discovery.log | grep -E "(进度|发现|阶段)"

# 查看已发现数量
wc -l all_plant_codes_progress.txt 2>/dev/null || echo "0"
```

### 停止爬虫

```bash
pkill -f smart_discovery.py
```

### 重新启动爬虫

```bash
python3 -u smart_discovery.py 0.5 > smart_discovery.log 2>&1 &
```

---

## ⏰ 时间表（参考）

根据0.5秒延迟估算：

| 阶段 | 测试数 | 预计耗时 | 累计时间 |
|------|--------|----------|----------|
| 阶段1 | 901 | 7.5分钟 | 7.5分钟 |
| 阶段2 | 4,510 | 37.6分钟 | 45分钟 |
| 阶段3 | 18,180 | 2.5小时 | 3.25小时 |
| 阶段4 | 13,680 | 1.9小时 | 5.2小时 |

**实际可能更慢**（每个请求1-2秒），预计：**8-12小时**

---

## 📞 故障排查

### 监控工具显示"未运行"

```bash
# 检查进程
ps aux | grep smart_discovery

# 如果没有进程，重新启动
python3 -u smart_discovery.py 0.5 > smart_discovery.log 2>&1 &
```

### 进度不更新

```bash
# 查看日志是否有错误
tail -50 smart_discovery.log

# 检查网络连接
curl -I "https://tai2.ntu.edu.tw" --max-time 5
```

### 进度文件不存在

正常！进度文件每500个测试才保存一次，耐心等待。

---

## 💡 提示

1. **监控工具不会影响爬虫**
   - 可以随时打开和关闭监控
   - 爬虫在后台独立运行

2. **多次运行监控**
   - 可以在不同终端窗口同时查看
   - 建议使用 `screen` 或 `tmux` 保持监控窗口

3. **明天查看结果**
   - 启动后可以关闭监控
   - 明天直接查看 `all_plant_codes.txt`

---

## 🎉 完成后

当所有阶段完成，您会得到：

- `all_plant_codes.txt` - 所有发现的编码
- `all_plant_codes.json` - JSON格式（含元数据）

然后自动运行爬取：

```bash
python3 robust_crawler.py all_plant_codes.txt 1.5
```

---

**祝您数据收集顺利！🌿**
