# RAG 辨識改進工項計畫

依序執行，每步完成後測試再進入下一步。

---

## 工項清單

| 步驟 | 工項 | 狀態 | 備註 |
|------|------|------|------|
| 1 | 補齊 traits-parser 映射 | ✅ 完成 | racemose、spiral、leaf_type、compound_type |
| 2 | flower_color/seed_color 混淆處理 | ✅ 完成 | 種子顏色誤填 flower_color 時丟棄 |
| 3 | 擴大 top_k (3→30) | ✅ 完成 | Node 端 RAG_TOP_K=30，可 env 覆寫 |
| 4 | 移除 +0.15 gate，改合併打分 | ✅ 完成 | mergePlantResults 合併兩階段候選 |
| 5 | 測試 10~15 筆驗證 | 待進行 | 每步完成後執行 |
| (可選) | 矛盾淘汰 / 動態權重 / MMR | 待討論 | 視步驟 5 結果決定 |

---

## 進階工項（建議最後處理）

| 工項 | 說明 | 建議順序 |
|------|------|----------|
| **動態權重** | 依 traits 品質調整 embed/feature 權重，需定義品質門檻與權重區間 | 最後 |
| **矛盾規則具體化** | 定義哪些 trait 組合視為矛盾、規則列表與優先順序 | 最後 |

**理由**：這兩項依賴既有流程穩定（映射、top_k、合併打分）且辨識率有初步提升後，才有足夠數據調整參數。過早引入可能增加複雜度、難以除錯。

---

## 注意事項

- **補齊映射不需重新向量化**：只影響查詢端
- **準確度優先**：速度優化延後
- **每步獨立 commit**：便於回滾
